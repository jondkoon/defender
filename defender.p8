pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
start_x = 20
start_y = 60
x = start_x
y = start_y
dy = 0.5
start_dx = 0.5
dx = start_dx
max_dx = 2
ddy = 0.15
ddx = 0.8
decel = 0.5
s = {}
s.ship = 1
s.tail_blast_counter = 0
screen_width = 128
screen_height = 128
ship_height = 8
max_y = screen_height - ship_height

stars = {}
for i = 0, 50 + rnd(50) do
	local s = { 
		x = -56 + rnd(128 * 2),
		y = -start_y + rnd(128 + (start_y * 2))
	}
	add(stars, s)
end

function update_stars()
	local window_start = x - 20
	local window_end = window_start + 128
	for s in all(stars) do
		if (s.x < window_start - 56) then
			s.x = window_end + rnd(56)
			s.y = -start_y + rnd(128 + (start_y * 2))
		elseif (s.x > window_end + 56) then
			s.x = window_start - rnd(56)
			s.y = -start_y + rnd(128 + (start_y * 2))
		end
	end	
end

function draw_stars()
	for s in all(stars) do
		line(s.x, s.y, s.x+dx, s.y, 7)
	end
end

shots = {}
function make_shot()
	local shot = {}
	shot.x = x+x_offset()
	shot.y = y+4
	shot.dx = max(dx + 5, 3)
	shot.length = 5 + rnd(5)
	add(shots,shot)
end

function draw_shots()
	for shot in all(shots) do
		line(shot.x, shot.y, shot.x+shot.length, shot.y, 12)
	end
end

function update_shots()
	for shot in all(shots) do
		shot.x += shot.dx
		if (shot.x > x + 128) then
			del(shots,shot)
		end
	end
end

function _update60()
	if(btn(⬆️)) then
		dy = dy or -0.5
		dy -= ddy
	elseif(btn(⬇️)) then
		dy = dy or 0.5
		dy += ddy
	else
		if (abs(dy) <= decel) then
			dy = 0
		elseif (dy <= 0) then
			dy += decel
		elseif (dy > 0) then
			dy -= decel
		end
	end
	
	if (btn(➡️) and dx < max_dx) then
		dx += ddx
	elseif (btn(⬅️) and dx > -max_dx) then
		dx -= ddx
	end
	
	y += dy
	x += dx
	
	if (y > max_y) then
		dy = -1
		y = max_y
	elseif (y < 0) then
		dy = 1
		y = 0
	end
	
	if (dy <= -1.5) then
		s.ship = 3
	elseif (dy <= -1) then
		s.ship = 2
	elseif (dy >= 1.5) then
		s.ship = 5
	elseif (dy >= 1) then
		s.ship = 4
	else
		s.ship = 1
	end

	if (dx < 0) then
		s.ship += 5
	end
	
	if (abs(dx) > 0) then
		local sprite_start = 17
		if (dx < 0) then
			sprite_start = 33
		end
		local sprite_end = sprite_start + 8
		s.tail = min(sprite_end, sprite_start + (2 * flr(((abs(dx) - start_dx) / 0.4))))
		if (s.tail == sprite_end) then
			if (s.tail_blast_counter == 0 and flr(rnd(10)) == 1) then
				s.tail_blast_counter = 5
			elseif (s.tail_blast_counter > 0) then
				s.tail_blast_counter -= 1
				s.tail = sprite_end + 2
			end
		end
	else
		s.tail = nil
	end

	if (btn(4)) then
		if (shot_delay == 0) then
			shot_delay = 8
			make_shot()
		else
			shot_delay -= 1
		end
	else
		shot_delay = 0
	end	

	update_stars()
	update_shots()
end

function set_camera(p)
	local parallax = p or 1
	camera(x-start_x / parallax, y-start_y)
end

function x_offset()
	return flr(dx / 0.5)
end

function _draw()
	cls(0)
	set_camera(1)
	draw_stars()
	draw_shots()
	local offset = x_offset()
	if (s.tail) then
		local tail_offset = -8
		if (dx < 0) then
			tail_offset = 8
		end
		spr(s.tail, x+offset+tail_offset, y)
	end	
	spr(s.ship, x+offset, y)
end
__gfx__
00000000000000000000000000000000000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000000000
00000000066600000000000000000000000000000000000000066660000666600000000000066660000000000000000000000000000000000000000000000000
00700700066660000666600000000000066660000000000006655555066557770005577706666660000000000000000000000000000000000000000000000000
00077000555556607775566077755000066666600000000055555777555555555666666555555555566666650000000000000000000000000000000000000000
00077000777555555555555556666665555555555666666506655555066666600000000006655777000557770000000000000000000000000000000000000000
00700700555556600666666000000000777556607775500000066660000666600000000000066660000000000000000000000000000000000000000000000000
00000000066660000666600000000000066660000000000000006660000000000000000000000000000000000000000000000000000000000000000000000000
00000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000666000000000000066600000000000006660000000000000666000000000000066600000000000006660000000000000000000000000000
00000000000000000666600000000000066660000000000006666000000000000666600000000000066660000000000006666000000000000000000000000000
00000000000000005555566000000009555556600000009a555556600000009a555556600000009a55555660000009a755555660000000000000000000000000
0000000000000009775555550000009777555555000009a777555555000099a777555555000009a77755555500099a7777555555000000000000000000000000
00000000000000005555566000000009555556600000009a555556600000009a555556600000009a55555660000009a755555660000000000000000000000000
00000000000000000666600000000000066660000000000006666000000000000666600000000000066660000000000006666000000000000000000000000000
00000000000000000666000000000000066600000000000006660000000000000666000000000000066600000000000006660000000000000000000000000000
00006660000000000000666000000000000066600000000000006660000000000000666000000000000066600000000000000000000000000000000000000000
00066660000000000006666000000000000666600000000000066660000000000006666000000000000666600000000000000000000000000000000000000000
0665555500000000066555559000000006655555a900000006655555a900000006655555a9000000066555557a90000000000000000000000000000000000000
55555577900000005555557779000000555555777a900000555555777a990000555555777a9000005555557777a9900000000000000000000000000000000000
0665555500000000066555559000000006655555a900000006655555a900000006655555a9000000066555557a90000000000000000000000000000000000000
00066660000000000006666000000000000666600000000000066660000000000006666000000000000666600000000000000000000000000000000000000000
00006660000000000000666000000000000066600000000000006660000000000000666000000000000066600000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd000000550000001100000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dddd00005555000011110000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dd88ddd055aa55501122111011cc111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dd88d00055aa50001122100011cc10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dd88d00055aa50001122100011cc10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dd88ddd055aa55501122111011cc111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dddd00005555000011110000111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd000000550000001100000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000ddd000005550000022200000ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dddd00005555000022220000cccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dd2222205511111022111110cc11111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222888111118881111188811111888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0dd2222205511111022111110cc11111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dddd00005555000022220000cccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000ddd000005550000022200000ccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77755555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
